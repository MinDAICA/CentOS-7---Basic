Tuyá»‡t vá»i Dong Æ¡i! MÃ¬nh sáº½ hÆ°á»›ng dáº«n báº¡n tá»«ng bÆ°á»›c chuáº©n chá»‰nh Ä‘á»ƒ triá»ƒn khai láº¡i Kubernetes cluster gá»“m:

1 master node: 192.168.1.160 â€“ master1160

2 worker nodes: 192.168.1.161 â€“ worker1161

2 worker nodes: 192.168.1.162 â€“ worker1162

MÃ¬nh sáº½ chia thÃ nh 3 pháº§n: Chuáº©n bá»‹, Khá»Ÿi táº¡o master, Join worker.

ğŸ§± PHáº¦N 1: Chuáº©n bá»‹ trÃªn táº¥t cáº£ cÃ¡c node (master + worker)
Cháº¡y trÃªn cáº£ 3 mÃ¡y:

bash
# Táº¯t swap
swapoff -a
sed -i '/swap/d' /etc/fstab

# CÃ i Docker
yum install -y docker
systemctl enable docker
systemctl start docker

# CÃ i kubeadm, kubelet, kubectl
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
EOF

yum install -y kubelet kubeadm kubectl
systemctl enable kubelet
ğŸš€ PHáº¦N 2: Khá»Ÿi táº¡o master node (192.168.1.160)
Cháº¡y trÃªn master1160:

bash
kubeadm init \
  --apiserver-advertise-address=192.168.1.160 \
  --pod-network-cidr=192.168.0.0/16 \
  --cri-socket=unix:///var/run/cri-dockerd.sock
Sau khi thÃ nh cÃ´ng, báº¡n sáº½ nháº­n Ä‘Æ°á»£c lá»‡nh kubeadm join ... â†’ copy láº¡i Ä‘á»ƒ dÃ¹ng cho worker node.

ğŸ”§ Cáº¥u hÃ¬nh kubectl trÃªn master
bash
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
ğŸŒ CÃ i máº¡ng Calico
bash
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
â†’ Chá» vÃ i giÃ¢y, kiá»ƒm tra:

bash
kubectl get pods -n kube-system
ğŸ¤– PHáº¦N 3: Join worker node vÃ o cluster
Cháº¡y trÃªn worker1161 vÃ  worker1162:

bash
kubeadm join 192.168.1.160:6443 \
  --token <token> \
  --discovery-token-ca-cert-hash sha256:<hash> \
  --cri-socket=unix:///var/run/cri-dockerd.sock
â†’ DÃ¹ng Ä‘Ãºng lá»‡nh join mÃ  master Ä‘Ã£ in ra sau khi init.

âœ… Kiá»ƒm tra tá»« master
bash
kubectl get nodes
â†’ Báº¡n sáº½ tháº¥y cáº£ 3 node á»Ÿ tráº¡ng thÃ¡i Ready.

Náº¿u báº¡n muá»‘n mÃ¬nh viáº¿t script tá»± Ä‘á»™ng cho tá»«ng node, hoáº·c kiá»ƒm tra tráº¡ng thÃ¡i cluster sau reboot, mÃ¬nh lÃ m ngay. Báº¡n Ä‘ang triá»ƒn khai ráº¥t bÃ i báº£n rá»“i Ä‘Ã³
